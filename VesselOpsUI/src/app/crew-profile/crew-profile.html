<!-- Wrapper: Only show when data is ready -->
<div class="container-fluid" *ngIf="crewMember; else loading">

  <!-- DEBUG LINE: Remove this after you see it working! -->
  <div class="alert alert-info py-1 small">
    Data Loaded: {{ crewMember.fullName }} | Phone in DB: {{ crewMember.phoneNumber }} | Email in DB: {{ crewMember.email }}
  </div>

  <!-- 1. Header Section -->
  <div class="d-flex justify-content-between align-items-center mb-3">
    <div class="d-flex align-items-center gap-2">
  <!-- This button now has the power to change the page! -->
  <button class="btn btn-sm btn-outline-secondary border-0" routerLink="/seafarers/list">
    <i class="bi bi-arrow-left fs-5"></i>
  </button>
      <nav aria-label="breadcrumb">
        <ol class="breadcrumb mb-0">
          <li class="breadcrumb-item text-muted">Overview</li>
          <li class="breadcrumb-item active fw-bold text-dark">{{ crewMember.fullName }}</li>
        </ol>
      </nav>
    </div>
    <div class="d-flex gap-2">
      <button class="btn btn-sm btn-outline-secondary" (click)="onEdit()">
        <i class="bi" [ngClass]="isEditMode ? 'bi-x-lg' : 'bi-pencil-square'"></i> {{ isEditMode ? 'Cancel' : 'Edit' }}
      </button>
      <button *ngIf="isEditMode" class="btn btn-sm btn-success" (click)="onSave()">Save Changes</button>
      <button class="btn btn-sm btn-outline-danger" (click)="onArchive()">Delete</button>
    </div>
  </div>

  <!-- 2. Profile Card -->
  <div class="card shadow-sm border-0 mb-4">
    <div class="card-body p-4">
      <div class="row">
        
        <!-- Left Side -->
        <div class="col-lg-9 border-end pe-4">
          <div class="d-flex gap-4 mb-4">
            <div class="position-relative">
  <!-- We use [src] to bind the database value to the image path -->
  <img [src]="'assets/' + crewMember.photoUrl" 
       class="rounded-circle border shadow-sm" 
       width="95" height="90" 
       alt="Crew Avatar">
  
  <!-- The Green Status Dot -->
  <span class="position-absolute bottom-0 end-0 p-2 bg-success border border-light rounded-circle"></span>
</div>
            <div>
              <h3 *ngIf="!isEditMode" class="fw-bold mb-0 text-marine">{{ crewMember.fullName }}</h3>
              <input *ngIf="isEditMode" type="text" class="form-control fw-bold" [(ngModel)]="crewMember.fullName">
              
              <div *ngIf="!isEditMode" class="text-muted fw-bold">{{ crewMember.rank }}</div>
              <input *ngIf="isEditMode" type="text" class="form-control form-control-sm mt-1" [(ngModel)]="crewMember.rank">
            </div>
          </div>

          <!-- THE CONTACT GRID (Phone, Email, WhatsApp) -->
          <div class="row g-4">
            
            <!-- ROW 1: ID & Nationality -->
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between">
                <span class="text-muted small">ID</span>
                <span class="fw-bold">{{ crewMember.id }}</span>
              </div>
            </div>
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between">
                <span class="text-muted small">Nationality</span>
                <span *ngIf="!isEditMode">{{ crewMember.nationality }}</span>
                <input *ngIf="isEditMode" type="text" class="form-control form-control-sm w-50" [(ngModel)]="crewMember.nationality">
              </div>
            </div>

            <!-- ROW 2: Phone & Email -->
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small"><i class="bi bi-telephone me-2"></i>Phone</span>
                <span *ngIf="!isEditMode" class="fw-bold text-primary">{{ crewMember.phoneNumber }}</span>
                <input *ngIf="isEditMode" type="text" class="form-control form-control-sm w-50" [(ngModel)]="crewMember.phoneNumber">
              </div>
            </div>
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small"><i class="bi bi-envelope me-2"></i>Email</span>
                <span *ngIf="!isEditMode" class="fw-bold text-primary">{{ crewMember.email }}</span>
                <input *ngIf="isEditMode" type="email" class="form-control form-control-sm w-50" [(ngModel)]="crewMember.email">
              </div>
            </div>

            <!-- ROW 3: WhatsApp & City -->
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small"><i class="bi bi-whatsapp me-2"></i>WhatsApp</span>
                <!-- We use phoneNumber here because WhatsApp isn't in your SQL table yet -->
                <span *ngIf="!isEditMode" class="fw-bold text-success">{{ crewMember.phoneNumber }}</span>
                <input *ngIf="isEditMode" type="text" class="form-control form-control-sm w-50" [(ngModel)]="crewMember.phoneNumber">
              </div>
            </div>
            <div class="col-md-6 border-bottom pb-2">
              <div class="d-flex justify-content-between align-items-center">
                <span class="text-muted small">City</span>
                <span *ngIf="!isEditMode">{{ crewMember.city }}</span>
                <input *ngIf="isEditMode" type="text" class="form-control form-control-sm w-50" [(ngModel)]="crewMember.city">
              </div>
            </div>

          </div>
        </div>

        <!-- Right Side Panel -->
        <div class="col-lg-3 ps-4">
          <label class="small text-muted fw-bold">Available from</label>
          <input type="text" class="form-control form-control-sm mb-3" value="28.11.2023" disabled>
          
          <label class="small text-muted fw-bold">Min salary</label>
          <input type="text" class="form-control form-control-sm mb-3" value="20300" disabled>
          
          <label class="small text-muted fw-bold">Notes</label>
          <div class="bg-light p-2 rounded small border-start border-primary border-3">
            Connected to SQL Server Management Studio
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- 3. Bottom Experience Cards -->
  <div class="row g-4">
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold text-marine border-bottom pb-2">Experience</h6>
          <div class="d-flex justify-content-between">
            <span>Total Years</span>
            <strong *ngIf="!isEditMode">{{ crewMember.totalExperienceYears }} y</strong>
            <input *ngIf="isEditMode" type="number" class="form-control form-control-sm w-25" [(ngModel)]="crewMember.totalExperienceYears">
          </div>
        </div>
      </div>
    </div>
    <!-- Card 2: Rank Exp -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold text-marine border-bottom pb-2">Rank Experience</h6>
          <div class="d-flex justify-content-between">
            <span>{{ crewMember.rank }}</span>
            <strong *ngIf="!isEditMode">{{ crewMember.rankExperienceYears }} y</strong>
            <input *ngIf="isEditMode" type="number" class="form-control form-control-sm w-25" [(ngModel)]="crewMember.rankExperienceYears">
          </div>
        </div>
      </div>
    </div>
    <!-- Card 3: Vessel Exp -->
    <div class="col-md-4">
      <div class="card shadow-sm border-0">
        <div class="card-body">
          <h6 class="fw-bold text-marine border-bottom pb-2">Vessel Experience</h6>
          <div class="d-flex justify-content-between">
            <span>All Vessels</span>
            <strong *ngIf="!isEditMode">{{ crewMember.vesselExperienceYears }} y</strong>
            <input *ngIf="isEditMode" type="number" class="form-control form-control-sm w-25" [(ngModel)]="crewMember.vesselExperienceYears">
          </div>
        </div>
      </div>
    </div>
  </div>

</div>

<!-- Loading Template -->
<ng-template #loading>
  <div class="text-center mt-5 py-5">
    <div class="spinner-border text-primary"></div>
    <p class="mt-2 text-muted">Talking to C# Backend...</p>
  </div>
</ng-template>